<script src="//maps.google.com/maps/api/js?v=3.13&amp;sensor=false&amp;libraries=geometry" type="text/javascript"></script>
<script src='//google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js' type='text/javascript'></script>

<div class="page-header" style="background-image: url('<%= @hackathon.image_url %>');width:100%;
  height:200px;background-size:cover;">
  <h1>
  <%= @hackathon.title %>
  <small>
    <%= link_to @hackathon.city, hackathons_by_city_path(country: @hackathon.country.parameterize, city: @hackathon.city.parameterize) %>, 
    <%= link_to @hackathon.country, hackathons_by_country_path(country: @hackathon.country.parameterize) %>
  </small>
</h1>
</div>


<p class="lead">
  <strong>
    <%= l(@hackathon.date_start, format: "%A, %e %b") %>
  </strong>
  â€“
  <strong>
    <%= l(@hackathon.date_end, format: "%A, %e %b %Y") %>
  </strong>
</p>

<p>
  <%= link_to "Visit Website", @hackathon.url, class: "btn btn-primary", target: "_blank" %>
  <%= link_to "Share on Twitter", "https://twitter.com/home?status=HACKATHON%20%7C%C2%A0#{ @hackathon.country }%20%7C%C2%A0#{ @hackathon.city }%20%7C%C2%A0#{ @hackathon.title }%20#{ @hackathon.date_start.strftime("%d/%m/%Y") }%20#{ request.url }%20#{ @hackathon.twitter }%20@hackevents", class: "btn btn-default", target: "_blank" %>
</p>

<hr />

<address>
  <strong><%= @hackathon.venue %></strong><br />
  <%= @hackathon.address %>
</address>
<p>
  <%= link_to "<i class='glyphicon glyphicon-map-marker'></i>&nbsp; Get Directions" .html_safe, "https://maps.google.com?daddr=#{ @hackathon.address }", class: "btn btn-default", target: "_blank" %>
</p>

<hr />

<% if logged_in? %>
  <p>
    <% if current_user.following_hackathon?(@hackathon)  %>
      <%= link_to "Remove from favorites", unfollow_hackathon_path(@hackathon), class: "btn", :method => :post %>
    <% else %>
      <%= link_to "Add to favorites", follow_hackathon_path(@hackathon), class: "btn", :method => :post %>
    <% end %>
  </p>
  <hr />
<% end %>

<% if @hackathon.users.present? %>
  <ul class="users follow">
    <% @hackathon.users.each do |u| %>
      <div>
        <% unless current_user == u %>
          <%= link_to image_tag( u.twitter_account.profile_image, class: "img-circle", size: "40x40"), user_path(u) %>
          <%= link_to "#{u.first_name} #{u.last_name}", user_path(u) %>
        <% else %>
          <%= link_to image_tag( u.twitter_account.profile_image, class: "img-circle", size: "40x40"), profile_path %>
          <%= link_to "#{u.first_name} #{u.last_name}", profile_path %>
        <% end %>
      </div>
    <% end %>
  </ul>
  <hr />
<% end %>

<div id="map" style='width: 100%; height: 300px;'></div>

<% if logged_in? %>
  <p>
    <%= mail_to 'michael@hackevents.co', 'Report Hackathon', subject: "Error with #{@hackathon.title}" %>
    <br />
    Send us an email at <%= mail_to 'michael@hackevents.co', 'Report Hackathon', subject: "Error with #{@hackathon.title}" %> if there is wrong information about this hackathon.
  </p>
<% else %>
  <p>
    Please <%= link_to "log in", login_path %> to report an error in the hackathon.
  </p>
<% end %>

<hr />

<p class="categories-list">
  <% @hackathon.categories.each do |c| %>
    <span class="categories-list-item" style="background-color: #<%= c.primary_hex_color %>;">
      <%= c.name %>
    </span>
  <% end %>
</p>


<script type="text/javascript" src="http://maps.google.com/maps/api/js?v=3.exp&sensor=false"></script>
<script class="hide-on-med-and-down" type="text/javascript">
  var geocoder;
  var map;
  var address;

  function initialize() {
    var latlng     = new google.maps.LatLng(48.152015087280915, 11.576017141342163);
    var mapOptions = {
      zoom:   12,
      center: latlng
    }
    map       = new google.maps.Map(document.getElementById('map'), mapOptions);
    geocoder  = new google.maps.Geocoder();
    address   = "<%= @hackathon.address %>";
    geocoder.geocode( { 'address': address}, function(results, status) {
      if (status == google.maps.GeocoderStatus.OK) {
        map.setCenter(results[0].geometry.location);
        var marker = new google.maps.Marker({
            map: map,
            position: results[0].geometry.location
        });
      } else {
        alert('Geocode was not successful for the following reason: ' + status);
      }
    });
  }
  google.maps.event.addDomListener(window, 'load', initialize);
</script>
